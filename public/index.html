<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bilancio Famiglia</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; }
    .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { text-align: center; color: #2c3e50; }
    #balance { text-align: center; font-size: 1.4em; margin: 15px 0; color: #27ae60; font-weight: bold; }
    input, select, button { width: 100%; padding: 10px; margin: 8px 0; box-sizing: border-box; border: 1px solid #ddd; border-radius: 5px; }
    button { background: #3498db; color: white; border: none; cursor: pointer; }
    button:hover { background: #2980b9; }
    ul { list-style: none; padding: 0; }
    li { padding: 12px; margin: 10px 0; background: #ecf0f1; border-radius: 5px; display: flex; justify-content: space-between; }
    .delete-btn { background: #e74c3c; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üí∞ Bilancio Famiglia</h1>
    <div id="balance">Saldo: ‚Ç¨0.00</div>

    <form id="form">
      <select id="type">
        <option value="entrata">Entrata</option>
        <option value="uscita">Uscita</option>
      </select>
      <input type="text" id="category" placeholder="Categoria (es. Stipendio, Spesa...)" required />
      <input type="number" id="amount" step="0.01" placeholder="Importo" required />
      <input type="date" id="date" required />
      <input type="text" id="note" placeholder="Note (opzionale)" />
      <button type="submit">Aggiungi Movimento</button>
    </form>

    <h2>üìù Movimenti Recenti</h2>
    <ul id="list"></ul>
  </div>

  <script>
    const API = '/api/movements';
    
    async function update() {
      // Saldo
      const bal = await fetch(`${API}/balance`).then(r => r.json());
      document.getElementById('balance').innerText = `Saldo: ‚Ç¨${bal.balance.toFixed(2)}`;
      
      // Lista
      const movs = await fetch(API).then(r => r.json());
      const list = document.getElementById('list');
      list.innerHTML = movs.map(m => 
        `<li>
          <span>${m.type === 'entrata' ? '‚ûï' : '‚ûñ'} 
          ${m.date} ‚Äî <strong>${m.category}</strong>: ‚Ç¨${Number(m.amount).toFixed(2)}
          ${m.note ? `<em>(${m.note})</em>` : ''}
          </span>
          <span class="delete-btn" onclick="del(${m.id})">üóëÔ∏è</span>
        </li>`
      ).join('');
    }

    async function del(id) {
      if (confirm('Confermi?')) {
        await fetch(`${API}/${id}`, { method: 'DELETE' });
        update();
      }
    }

    document.getElementById('form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = {
        type: document.getElementById('type').value,
        category: document.getElementById('category').value,
        amount: document.getElementById('amount').value,
        date: document.getElementById('date').value,
        note: document.getElementById('note').value || null
      };
      await fetch(API, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
      document.getElementById('form').reset();
      update();
    });

    // Inizializza
    document.getElementById('date').valueAsDate = new Date();
    update();
  </script>
</body>
</html>
